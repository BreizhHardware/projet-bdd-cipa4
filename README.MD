# Projet BDD - Gestion des installations photovoltaÃ¯ques

## ğŸŒŸ Introduction

Dans le cadre du cours de **Base de DonnÃ©es**, ce projet vous invite Ã  concevoir et interroger une base de donnÃ©es relationnelle portant sur les installations photovoltaÃ¯ques rÃ©sidentielles. Le jeu de donnÃ©es est fourni dans le cas du projet.

### ğŸ¯ Objectifs

- Construire un schÃ©ma relationnel en **3FN** (TroisiÃ¨me Forme Normale).
- Nettoyer et homogÃ©nÃ©iser les fichiers source.
- Charger les donnÃ©es dans une base de donnÃ©es **PostgreSQL**.
- RÃ©pondre Ã  un ensemble de requÃªtes d'analyse.

### ğŸ“Š Fichiers de Base

- `data.csv` : Contient les installations avec puissance crÃªte, surface, marques, orientation, etc.
- `communes-france-2024-limite.csv` : RÃ©fÃ©rentiel des communes franÃ§aises avec code INSEE, commune, dÃ©partement, rÃ©gion et code postal.

## ğŸ“‹ Requirements

- Python 3.x
- PostgreSQL
- [Poetry](https://python-poetry.org/docs/#installing-with-pipx) (pour la gestion des dÃ©pendances)

## ğŸš€ Installation

1. **Cloner le dÃ©pÃ´t GitHub** :

   ```bash
   git clone https://github.com/breizhhardware/projet-bdd-cipa4.git
   cd projet-bdd-cipa4/data-cleanup
   ```

2. **Installer les dÃ©pendances avec Poetry** :

   ```bash
   poetry install
   ```

3. **Configurer la base de donnÃ©es PostgreSQL** :
   Utilisez `database.sql` pour crÃ©er les tables nÃ©cessaires (si la base existe dÃ©jÃ , les tables seront supprimÃ©es avant d'Ãªtre recrÃ©Ã©es).

   ```bash
   psql -U votre_utilisateur -d votre_base_de_donnees -f ../sql/model/database.sql
   ```

4. **GÃ©nÃ©rer les scripts SQL pour insÃ©rer les donnÃ©es nettoyÃ©es** :
   âš ï¸ Cela peut prendre du temps en raison du traitement par IA (environ 13 min sur un MacBook Air M2).

   ```bash
   poetry run python src/data_cleanup/__init__.py
   ```

5. **InsÃ©rer les donnÃ©es nettoyÃ©es dans la base de donnÃ©es** :
   ```bash
   psql -U votre_utilisateur -d votre_base_de_donnees -f ../sql/seeder/insert_data.sql
   ```

## â–¶ï¸ ExÃ©cution

1. **Nettoyer et homogÃ©nÃ©iser les donnÃ©es** :

   ```bash
   poetry run python src/data_cleanup/__init__.py
   ```

2. **InsÃ©rer les donnÃ©es nettoyÃ©es dans PostgreSQL** :

   ```bash
   psql -U votre_utilisateur -d votre_base_de_donnees -f ../sql/seeder/insert_data.sql
   ```

3. **GÃ©nÃ©rer des cartes** :

âš ï¸ Il faut avoir exÃ©cutÃ© le script de nettoyage des donnÃ©es avant et avoir adapter le `.env.example` a votre environnement et le nommer en `.env`.

- Pour gÃ©nÃ©rer la carte des installations photovoltaÃ¯ques

```bash
poetry run python src/data_cleanup/map_visualization.py
```

- Pour gÃ©nÃ©rer les cartes de comparaison des pentes et orientation optimum

```bash
poetry run python src/data_cleanup/map_orientation_pente.py
```

4. **Visualiser les cartes** :
   - Ouvrez le fichier `carte_installations_france.html` dans votre navigateur.
   - Ouvrez le fichier `carte_ecart_orientation.html` dans votre navigateur.
   - Ouvrez le fichier `carte_ecart_pente.html` dans votre navigateur.

## ğŸ“ Structure du Projet

Voici un aperÃ§u de l'arborescence des fichiers du projet :

```
projet-bdd-cipa4/
â”œâ”€â”€ analyse_puissance_solaire_20251016_092823.png  # Image d'analyse de puissance solaire
â”œâ”€â”€ cleaned_data.csv                              # DonnÃ©es nettoyÃ©es
â”œâ”€â”€ communes-france-2024-limite.csv               # RÃ©fÃ©rentiel des communes franÃ§aises
â”œâ”€â”€ data_small.csv                                # Ã‰chantillon de donnÃ©es
â”œâ”€â”€ data.csv                                      # DonnÃ©es brutes des installations
â”œâ”€â”€ MCD.png                                     # Image du modÃ¨le conceptuel de donnÃ©es (MCD)
â”œâ”€â”€ Mcd_V1.mcd                                    # ModÃ¨le conceptuel de donnÃ©es (MCD)
â”œâ”€â”€ MLD.png                                     # Image du modÃ¨le logique de donnÃ©es (MLD)
â”œâ”€â”€ PrÃ©sentation projet.md                        # PrÃ©sentation du projet
â”œâ”€â”€ projet-cipa4-2025-nantes-lancement.pdf         # PDF de lancement du projet
â”œâ”€â”€ projet-cipa4-2025-nantes.pdf                   # PDF du projet
â”œâ”€â”€ README.MD                                     # Ce fichier
â”œâ”€â”€ run_results.sh                                # Script pour exÃ©cuter les requÃªtes SQL et afficher les rÃ©sultats dans le dossier sql/results/
â”œâ”€â”€ Tutoriel PostgreSQL projet cipa.pdf           # Tutoriel PostgreSQL
â”œâ”€â”€ data-cleanup/                                 # Dossier pour le nettoyage des donnÃ©es
â”‚   â”œâ”€â”€ carte_installations_france.html           # Carte interactive des installations
â”‚   â”œâ”€â”€ poetry.lock                               # Fichier de verrouillage Poetry
â”‚   â”œâ”€â”€ pyproject.toml                            # Configuration Poetry
â”‚   â”œâ”€â”€ src/                                      # Code source Python
â”‚   â”‚   â””â”€â”€ data_cleanup/
â”‚   â”‚       â”œâ”€â”€ __init__.py
â”‚   â”‚       â”œâ”€â”€ clean_data.py                     # Script de nettoyage des donnÃ©es
â”‚   â”‚       â”œâ”€â”€ config.py                         # Configuration
â”‚   â”‚       â”œâ”€â”€ detect_encoding.py                # DÃ©tection d'encodage
â”‚   â”‚       â”œâ”€â”€ generate_inserts.py               # GÃ©nÃ©ration des inserts SQL
â”‚   â”‚       â”œâ”€â”€ map_visualization.py              # Visualisation de la carte
|   |       â”œâ”€â”€ map_orientation_pente             # Visualisation de cartes sur l'orientation et les pentes
â”‚   â”‚       â”œâ”€â”€ query_12.py                       # RequÃªte spÃ©cifique
â”‚   â”‚       â””â”€â”€ utils.py                          # Utilitaires
â”‚   â””â”€â”€ tests/                                    # Tests unitaires
â”‚       â””â”€â”€ __init__.py
â””â”€â”€ sql/                                         # Scripts SQL
    â”œâ”€â”€ results/                                 # RÃ©sultats des requÃªtes
    â”œâ”€â”€ model/
    â”‚   â””â”€â”€ database.sql                          # CrÃ©ation des tables
    â”œâ”€â”€ requests/
    â”‚   â”œâ”€â”€ SqlRequests.sql                       # RequÃªtes d'analyse
    â”‚   â””â”€â”€ testModel.sql                        # Tests du modÃ¨le
    â””â”€â”€ seeder/
        â””â”€â”€ insert_data.sql                       # Insertion des donnÃ©es
```

- **Racine** : Contient les donnÃ©es brutes, les fichiers de prÃ©sentation et les images.
- **data-cleanup/** : Module Python pour le nettoyage et la visualisation des donnÃ©es.
- **sql/** : Scripts SQL pour la base de donnÃ©es, incluant le modÃ¨le, les requÃªtes et l'insertion des donnÃ©es.

## ğŸ” RequÃªtes SQL

Les requÃªtes SQL pour analyser les donnÃ©es sont disponibles dans le dossier `sql/requests/`. ExÃ©cutez-les dans votre base de donnÃ©es PostgreSQL pour obtenir les rÃ©sultats souhaitÃ©s.

```bash
psql -U votre_utilisateur -d votre_base_de_donnees -f ../sql/requests/SqlRequests.sql
```

Pour obtenir chaque rÃ©sultat dans un fichier sÃ©parÃ©, utilisez le script `run_results.sh` :

```bash
bash run_results.sh
```

## ğŸ‘¥ Auteurs

- [Candice PAILLUSSON](https://www.linkedin.com/in/candice-paillusson-504aaa26b/)
- [ClÃ©ment HERVOUET](https://www.linkedin.com/in/cl%C3%A9ment-hervouet-93b718259/)
- [FÃ©lix MARQUET](https://mrqt.fr)

---

_Projet rÃ©alisÃ© dans le cadre du cours de Base de DonnÃ©es Ã  l'ISEN Nantes._
